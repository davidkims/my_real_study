name: Generate and Deploy Scorecard Report

on:
  workflow_dispatch:

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Prepare .github/docs directory
        run: mkdir -p .github/docs

      - name: Generate Markdown report (no emojis)
        run: |
          REPORT=.github/docs/scorecard_report.md
          echo "# Scorecard 10/10 Security Setup Summary" > $REPORT
          echo "" >> $REPORT
          echo "| 항목 | 적용 여부 |" >> $REPORT
          echo "|------|-----------|" >> $REPORT
          echo "| Token Permissions | YES (자동 삽입) |" >> $REPORT
          echo "| Pinned Actions    | YES (버전 고정) |" >> $REPORT
          echo "| Security Policy   | YES (.md 생성됨) |" >> $REPORT
          echo "| Dependabot        | YES (자동 갱신) |" >> $REPORT
          echo "| CodeQL SAST       | YES (언어 조건 자동 실행) |" >> $REPORT
          echo "| Branch Protection | YES (gh CLI 적용) |" >> $REPORT
          echo "| GH_ADMIN_TOKEN    | YES (조건 처리) |" >> $REPORT

      - name: Install Pandoc + TeX Live
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc texlive texlive-latex-extra texlive-xetex

      - name: Convert Markdown to PDF
        run: |
          pandoc .github/docs/scorecard_report.md -o .github/docs/scorecard_report.pdf

      - name: Convert Markdown to HTML
        run: |
          pandoc .github/docs/scorecard_report.md -o .github/docs/scorecard_report.html

      - name: Upload pages artifact
        uses: actions/upload-pages-artifact@v2
        with:
          path: .github/docs

      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v2
