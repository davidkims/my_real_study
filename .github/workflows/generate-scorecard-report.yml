name: Generate Scorecard PDF Report

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  generate-pdf:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Prepare report directory
        run: mkdir -p .github/docs

      - name: Generate Markdown report
        run: |
          echo "# ✅ Scorecard 10/10 Security Setup Summary" > .github/docs/scorecard_report.md
          echo "" >> .github/docs/scorecard_report.md
          echo "| 항목 | 적용 여부 |" >> .github/docs/scorecard_report.md
          echo "|------|-----------|" >> .github/docs/scorecard_report.md
          echo "| Token Permissions | ✅ 자동 삽입 |" >> .github/docs/scorecard_report.md
          echo "| Pinned Actions    | ✅ 자동 처리 |" >> .github/docs/scorecard_report.md
          echo "| Security Policy   | ✅ 생성 완료 |" >> .github/docs/scorecard_report.md
          echo "| Dependabot        | ✅ 구성 완료 |" >> .github/docs/scorecard_report.md
          echo "| CodeQL SAST       | ✅ 언어 확인 후 실행 |" >> .github/docs/scorecard_report.md
          echo "| Branch Protection | ✅ gh API 적용 |" >> .github/docs/scorecard_report.md
          echo "| GH_ADMIN_TOKEN    | ✅ 조건 분기 처리 |" >> .github/docs/scorecard_report.md

      - name: Install Pandoc + Full TeX Live (for PDF)
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc texlive texlive-latex-extra texlive-xetex

      - name: Convert Markdown to PDF
        run: |
          pandoc .github/docs/scorecard_report.md -o .github/docs/scorecard_report.pdf

      - name: Upload PDF as artifact
        uses: actions/upload-artifact@v4
        with:
          name: scorecard-report
          path: .github/docs/scorecard_report.pdf
