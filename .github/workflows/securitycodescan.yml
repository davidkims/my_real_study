---
name: ì›Œí¬í”Œë¡œìš° ë³´ì•ˆ ì„¤ì • ìµœì í™” ì ê²€ (í† í° ì—†ì´ ì‹¤í–‰ ê°€ëŠ¥)

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  secure-fix-no-token:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ğŸ§ª .github/workflows ë‚´ ë³´ì•ˆ ê¶Œí•œ ì ê²€ ë° ìˆ˜ì • ì‹œë®¬ë ˆì´ì…˜
        run: |
          echo "ğŸ” ì›Œí¬í”Œë¡œìš° ë³´ì•ˆ ê¶Œí•œ ìµœì†Œí™” ì ê²€ ì¤‘..."
          mkdir -p logs
          cp -r .github/workflows logs/original_workflows
          
          find .github/workflows -name "*.yml" | while read FILE; do
            sed -i 's/permissions: write/permissions: read/g' "$FILE"
            sed -i 's/id-token: write/id-token: read/g' "$FILE"
            sed -i 's/security-events: write/security-events: read/g' "$FILE"
            sed -i 's/contents: write/contents: read/g' "$FILE"
            sed -i 's/actions: write/actions: read/g' "$FILE"
          done
          echo "âœ… ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ (íŒŒì¼ ìˆ˜ì •ë¨ - í‘¸ì‹œëŠ” ì•ˆí•¨)"

      - name: ğŸ“‹ ìˆ˜ì •ëœ ë‚´ìš© diff ì¶œë ¥
        run: |
          echo "ğŸ“„ ë³€ê²½ëœ ì›Œí¬í”Œë¡œìš° ë¹„êµ ê²°ê³¼ (Diff):"
          git config --global user.email "github-actions@github.com"
          git config --global user.name "github-actions"
          git init temprepo
          cd temprepo
          git init
          cp -r ../logs/original_workflows/* .
          git add .
          git commit -m "original"
          cd ..
          cp -r .github/workflows/* temprepo/
          cd temprepo
          git add .
          git diff --staged
          echo "âœ… diff ì¶œë ¥ ì™„ë£Œ"

      - name: ğŸ“Œ í›„ì† ì•ˆë‚´
        run: |
          echo "âš ï¸ ì›Œí¬í”Œë¡œìš° íŒŒì¼ì€ ìë™ í‘¸ì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
          echo "ğŸ‘‡ ì•„ë˜ì˜ diff ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ìˆ˜ë™ìœ¼ë¡œ PRì„ ìƒì„±í•´ ì£¼ì„¸ìš”."
