name: ì—ì‹œì»¬ì²´í¬ ë³´ì•ˆ í…ŒìŠ¤íŠ¸ ìžë™í™”

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]
  schedule:
    - cron: '39 2 * * 4'  # ë§¤ì£¼ ëª©ìš”ì¼ ì˜¤ì „ 11:39 (í•œêµ­ì‹œê°„ ê¸°ì¤€ UTC+9 â†’ UTC 2:39)
  workflow_dispatch:

permissions:
  contents: read
  security-events: write

jobs:
  ethicalcheck_security_scan:  # job IDëŠ” ì˜ì–´ë¡œë§Œ êµ¬ì„± (í•œê¸€ ì‚¬ìš© ë¶ˆê°€)
    name: ðŸ” EthicalCheck ìžë™ ë³´ì•ˆ ì ê²€  # ì‚¬ëžŒì´ ë³´ëŠ” ì´ë¦„, í•œê¸€ ë° ì´ëª¨ì§€ ê°€ëŠ¥
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¦ ë ˆí¬ì§€í† ë¦¬ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ðŸ“ ë””ìŠ¤í¬ ìŠ¬ë¡¯ ë° ë””ë ‰í† ë¦¬ ìƒì„±
        id: make-slot
        run: |
          TIMESTAMP=$(date +"%Y%m%d-%H%M%S")
          SLOT_DIR="disk-slot/slot-${TIMESTAMP}"
          echo "SLOT_DIR=$SLOT_DIR" >> $GITHUB_ENV
          mkdir -p "${SLOT_DIR}/logs"
          mkdir -p "${SLOT_DIR}/reports"
          echo "ðŸ“‚ ë””ìŠ¤í¬ ìŠ¬ë¡¯ ë””ë ‰í† ë¦¬ ìƒì„± ì™„ë£Œ: ${SLOT_DIR}"

      - name: ðŸ” EthicalCheck ìžë™ ë³´ì•ˆ ì ê²€ ì‹¤í–‰
        uses: apisec-inc/ethicalcheck-action@005fac321dd843682b1af6b72f30caaf9952c641
        with:
          # ðŸ”— ë³´ì•ˆ ì ê²€ ëŒ€ìƒ API ëª…ì„¸ (Swagger URL ë˜ëŠ” Postman Collection URL)
          oas-url: "http://netbanking.apisec.ai:8080/v2/api-docs"
          # ðŸ“§ ë¦¬í¬íŠ¸ ì „ì†¡ë°›ì„ ì´ë©”ì¼ ì£¼ì†Œ
          email: "your-email@example.com"
          # ðŸ§¾ SARIF ë¦¬í¬íŠ¸ ì €ìž¥ ê²½ë¡œ (ë””ìŠ¤í¬ ìŠ¬ë¡¯ êµ¬ì¡° í™œìš©)
          sarif-result-file: "${{ env.SLOT_DIR }}/reports/ethicalcheck-results.sarif"

      - name: â˜ï¸ GitHubì— SARIF ê²°ê³¼ ì—…ë¡œë“œ
        uses: github/codeql-action/upload-sarif@v3
        with:
          sarif_file: ${{ env.SLOT_DIR }}/reports/ethicalcheck-results.sarif

      - name: ðŸ§¾ ì‹¤í–‰ ë¡œê·¸ ê¸°ë¡
        run: |
          echo "âœ… EthicalCheck í…ŒìŠ¤íŠ¸ ì™„ë£Œ ì‹œê°: $(date)" > ${{ env.SLOT_DIR }}/logs/ethicalcheck.log
          ls -al ${{ env.SLOT_DIR }}/reports >> ${{ env.SLOT_DIR }}/logs/ethicalcheck.log
