name: ν†µν•© μ½”λ“ ν’μ§ κ²€μ‚¬

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  static-analysis:
    name: μ •μ  λ¶„μ„ λ° μ½”λ“ λ¦°νΈ
    runs-on: ubuntu-latest

    steps:
      - name: β… μ €μ¥μ† μ½”λ“ μ²΄ν¬μ•„μ›ƒ
        uses: actions/checkout@v4

      - name: π PHP λ„κµ¬ μ„¤μΉ (PHPMD, PHPStan, PHP_CodeSniffer)
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.1'
          tools: phpmd, phpstan, phpcs

      - name: π“¦ Python, Node.js, YAMLLint μ„¤μΉ
        run: |
          sudo apt-get update
          sudo apt-get install -y python3-pip npm yamllint
          pip3 install flake8
          npm install -g eslint

      - name: π“‚ logs λ””λ ‰ν† λ¦¬ μƒμ„±
        run: mkdir -p logs

      - name: π“„ PHP μ½”λ“ λ¶„μ„ - PHPMD
        run: |
          echo "β–¶ PHPMD μ‹¤ν–‰ μ¤‘..."
          phpmd . text codesize,unusedcode,naming || echo "β PHPMD μ¤λ¥ λ°μƒ" >> logs/phpmd.log

      - name: π“„ PHP μ½”λ“ λ¶„μ„ - PHPStan
        run: |
          echo "β–¶ PHPStan μ‹¤ν–‰ μ¤‘..."
          phpstan analyse --level=max . || echo "β PHPStan μ¤λ¥ λ°μƒ" >> logs/phpstan.log

      - name: π“„ PHP μ½”λ“ λ¶„μ„ - PHP_CodeSniffer
        run: |
          echo "β–¶ PHPCS μ‹¤ν–‰ μ¤‘..."
          phpcs . || echo "β PHPCS μ¤λ¥ λ°μƒ" >> logs/phpcs.log

      - name: π Python μ½”λ“ λ¶„μ„ - flake8
        run: |
          echo "β–¶ flake8 μ‹¤ν–‰ μ¤‘..."
          flake8 . || echo "β flake8 μ¤λ¥ λ°μƒ" >> logs/flake8.log

      - name: π”§ JavaScript μ½”λ“ λ¶„μ„ - ESLint
        run: |
          echo "β–¶ ESLint μ‹¤ν–‰ μ¤‘..."
          eslint . --ext .js || echo "β ESLint μ¤λ¥ λ°μƒ" >> logs/eslint.log

      - name: β™ YAML λ¬Έλ²• κ²€μ‚¬ - yamllint
        run: |
          echo "β–¶ yamllint μ‹¤ν–‰ μ¤‘..."
          yamllint .github/workflows || echo "β yamllint μ¤λ¥ λ°μƒ" >> logs/yamllint.log

      - name: π“Ά κ²°κ³Ό μ¶λ ¥ (ν•κµ­μ–΄)
        run: |
          echo ""
          echo "π§ μ½”λ“ ν’μ§ κ²€μ‚¬ μ”μ•½:"
          echo "-------------------------"
          for file in logs/*.log; do
            echo "π“„ κ²°κ³Ό νμΌ: $file"
            cat "$file"
            echo ""
          done
