---
name: ìµœëŒ€ ìš©ëŸ‰ ë””ë ‰í† ë¦¬ ë° íŒŒì¼ ìƒì„± with ì¬ì‹œë„ ë° í•œê¸€ ë¡œê·¸

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  create-directories:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„±
        run: |
          mkdir -p .github/workflows/{lint,security,deploy,ci,utils,auth,db,swift}
          echo "âœ… ë””ë ‰í† ë¦¬ ìƒì„± ì™„ë£Œ"

      - name: ğŸ“Œ .gitkeep íŒŒì¼ë¡œ ë””ë ‰í† ë¦¬ ì¶”ì  ì„¤ì •
        run: |
          find .github/workflows -type d -exec touch {}/.gitkeep \;
          echo "âœ… .gitkeep íŒŒì¼ ì¶”ê°€ ì™„ë£Œ"

      - name: ğŸ’¾ ìµœëŒ€ ìš©ëŸ‰ dummy íŒŒì¼ ìƒì„± (ì¬ì‹œë„ í¬í•¨)
        run: |
          echo "â³ ìµœëŒ€ ìš©ëŸ‰ dummy íŒŒì¼ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤ (auth 2GB, db 5GB, swift 7GB)..."
          RETRY_LIMIT=3
          for i in $(seq 1 $RETRY_LIMIT); do
            echo "ğŸ” ì‹œë„ $i..."
            dd if=/dev/zero of=.github/workflows/auth/.dummy_auth_data bs=1M count=2048 status=none &&
            dd if=/dev/zero of=.github/workflows/db/.dummy_db_data bs=1M count=5120 status=none &&
            dd if=/dev/zero of=.github/workflows/swift/.dummy_swift_reserve bs=1M count=7168 status=none &&
            echo "âœ… ëª¨ë“  íŒŒì¼ ìƒì„± ì„±ê³µ" && break
            echo "âš ï¸ ì‹¤íŒ¨ - ë””ìŠ¤í¬ ìš©ëŸ‰ ë¶€ì¡± ë˜ëŠ” ì˜¤ë¥˜ ë°œìƒ, 10ì´ˆ í›„ ì¬ì‹œë„..."
            sleep 10
          done
          echo "ğŸ›‘ ëª¨ë“  ì‹œë„ ì‹¤íŒ¨ ì‹œì—ë„ ì›Œí¬í”Œë¡œìš°ëŠ” ê³„ì† ì§„í–‰ë©ë‹ˆë‹¤."

      - name: ğŸ§¾ ìƒì„±ëœ íŒŒì¼ ë° ìš©ëŸ‰ í™•ì¸ (ì´ë²¤íŠ¸ ë·°ì–´)
        run: |
          echo "ğŸ“Š ìƒì„±ëœ íŒŒì¼ ëª©ë¡:"
          find .github/workflows -type f -exec du -h {} \;
          echo "âœ… ì™„ë£Œëœ ì‘ì—… ë¦¬ìŠ¤íŠ¸:"
          echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
          echo "ğŸ“‚ ë””ë ‰í† ë¦¬ ìƒì„± ì™„ë£Œ"
          echo "ğŸ“„ .gitkeep ì¶”ì  íŒŒì¼ ì¶”ê°€ ì™„ë£Œ"
          echo "ğŸ’½ ìµœëŒ€ìš©ëŸ‰ dummy íŒŒì¼ ìƒì„± ì™„ë£Œ"
          echo "ğŸ“‹ ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ ì¶œë ¥ ì™„ë£Œ"
          echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"

      - name: ğŸ§ª ë””ìŠ¤í¬ ì—¬ìœ  ê³µê°„ í™•ì¸
        run: |
          echo "ğŸ’¡ í˜„ì¬ ë””ìŠ¤í¬ ì—¬ìœ  ê³µê°„:"
          df -h / | awk '{print $1, $2, $3, $4, $5}' | column -t
